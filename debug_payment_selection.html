<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug Payment Selection</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .employee {
        margin: 10px 0;
        padding: 10px;
        border: 1px solid #ccc;
      }
      .stats {
        background: #f0f0f0;
        padding: 15px;
        margin: 20px 0;
      }
      .button {
        padding: 10px 20px;
        margin: 5px;
        cursor: pointer;
      }
      .selected {
        background: #e3f2fd;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Test de S√©lection des Employ√©s</h1>

    <div class="stats">
      <h3>Statistiques de S√©lection</h3>
      <p>Employ√©s s√©lectionn√©s: <span id="selectedCount">0</span></p>
      <p>IDs s√©lectionn√©s: <span id="selectedIds">Aucun</span></p>
      <p>Montant total: <span id="totalAmount">0 GNF</span></p>
    </div>

    <div>
      <button class="button" onclick="selectAll()">Tout s√©lectionner</button>
      <button class="button" onclick="deselectAll()">
        Tout d√©s√©lectionner
      </button>
      <button class="button" onclick="showDebug()">Debug</button>
      <button
        class="button"
        onclick="executePayment()"
        id="paymentBtn"
        disabled
      >
        Ex√©cuter Paiement
      </button>
    </div>

    <h3>Liste des Employ√©s</h3>
    <div id="employees">
      <!-- Les employ√©s seront ajout√©s ici -->
    </div>

    <script>
      // Donn√©es de test
      const testEmployees = [
        { id: "emp1", nom: "Jean Dupont", salaire: 500000, eligible: true },
        { id: "emp2", nom: "Marie Martin", salaire: 450000, eligible: true },
        { id: "emp3", nom: "Pierre Durand", salaire: 600000, eligible: false },
        { id: "emp4", nom: "Sophie Leroy", salaire: 550000, eligible: true },
      ];

      let selectedEmployees = new Set();

      // Initialiser la liste des employ√©s
      function initEmployees() {
        const container = document.getElementById("employees");
        container.innerHTML = "";

        testEmployees.forEach((emp) => {
          const div = document.createElement("div");
          div.className = "employee";
          div.innerHTML = `
                    <input type="checkbox" id="${
                      emp.id
                    }" onchange="toggleEmployee('${emp.id}')" ${
            !emp.eligible ? "disabled" : ""
          }>
                    <label for="${emp.id}">
                        ${emp.nom} - ${emp.salaire.toLocaleString()} GNF
                        ${!emp.eligible ? " (Non √©ligible)" : ""}
                    </label>
                `;
          container.appendChild(div);
        });
      }

      // Basculer la s√©lection d'un employ√©
      function toggleEmployee(employeeId) {
        const checkbox = document.getElementById(employeeId);
        const employeeDiv = checkbox.closest(".employee");

        if (checkbox.checked) {
          selectedEmployees.add(employeeId);
          employeeDiv.classList.add("selected");
        } else {
          selectedEmployees.delete(employeeId);
          employeeDiv.classList.remove("selected");
        }

        updateStats();
        console.log("‚úÖ Employee Selection:", {
          employeeId,
          checked: checkbox.checked,
          selectedEmployees: Array.from(selectedEmployees),
          totalSelected: selectedEmployees.size,
        });
      }

      // Mettre √† jour les statistiques
      function updateStats() {
        const selectedArray = Array.from(selectedEmployees);
        const selectedEmployeesData = testEmployees.filter((emp) =>
          selectedArray.includes(emp.id)
        );

        const stats = {
          count: selectedEmployeesData.length,
          total: selectedEmployeesData.reduce(
            (sum, emp) => sum + emp.salaire,
            0
          ),
        };

        document.getElementById("selectedCount").textContent = stats.count;
        document.getElementById("selectedIds").textContent =
          selectedArray.join(", ") || "Aucun";
        document.getElementById(
          "totalAmount"
        ).textContent = `${stats.total.toLocaleString()} GNF`;

        // Activer/d√©sactiver le bouton de paiement
        const paymentBtn = document.getElementById("paymentBtn");
        paymentBtn.disabled = stats.count === 0;

        console.log("üîç Selection Stats:", {
          selectedEmployees: selectedArray,
          eligibleEmployees: testEmployees.filter((emp) => emp.eligible).length,
          totalEmployees: testEmployees.length,
          stats,
        });
      }

      // S√©lectionner tous les employ√©s √©ligibles
      function selectAll() {
        testEmployees.forEach((emp) => {
          if (emp.eligible) {
            const checkbox = document.getElementById(emp.id);
            if (!checkbox.checked) {
              checkbox.checked = true;
              toggleEmployee(emp.id);
            }
          }
        });
      }

      // D√©s√©lectionner tous les employ√©s
      function deselectAll() {
        selectedEmployees.forEach((empId) => {
          const checkbox = document.getElementById(empId);
          checkbox.checked = false;
          toggleEmployee(empId);
        });
      }

      // Afficher les informations de debug
      function showDebug() {
        const debugInfo = {
          selectedEmployees: Array.from(selectedEmployees),
          selectedEmployeesSize: selectedEmployees.size,
          testEmployees: testEmployees,
          paymentDataExists: true,
          employesCount: testEmployees.length,
          employesEligibles: testEmployees.filter((emp) => emp.eligible).length,
        };

        console.log("üîç Debug Info:", debugInfo);
        alert(
          `Debug:\n- ${selectedEmployees.size} employ√©s s√©lectionn√©s\n- ${
            testEmployees.length
          } employ√©s total\n- ${
            testEmployees.filter((emp) => emp.eligible).length
          } employ√©s √©ligibles`
        );
      }

      // Ex√©cuter le paiement (simulation)
      function executePayment() {
        if (selectedEmployees.size === 0) {
          alert("Veuillez s√©lectionner au moins un employ√©");
          return;
        }

        const selectedArray = Array.from(selectedEmployees);
        const selectedEmployeesData = testEmployees.filter((emp) =>
          selectedArray.includes(emp.id)
        );
        const totalAmount = selectedEmployeesData.reduce(
          (sum, emp) => sum + emp.salaire,
          0
        );

        console.log(
          "üîÑ Ex√©cution des paiements pour",
          selectedEmployees.size,
          "employ√©s"
        );
        console.log("üí∞ Montant total:", totalAmount.toLocaleString(), "GNF");

        alert(
          `Paiements ex√©cut√©s pour ${
            selectedEmployees.size
          } employ√©s!\nMontant total: ${totalAmount.toLocaleString()} GNF`
        );
      }

      // Initialiser au chargement de la page
      window.onload = function () {
        initEmployees();
        updateStats();
      };
    </script>
  </body>
</html>
